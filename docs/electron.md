# Electron

In this sections we are going through `electron` setup. As you know, electron application is split into 2 separate
bundle with separate entry points. First is the `main` process which launches the application, tweaks its settings, e.g.
window size. Fusebox has a special launcher for that one.

A working example can be found [here](https://github.com/fuse-box/fuse-box-electron-seed)

## Configuration the launcher

Electron launcher must consist of bundle. FuseBox manages bundles automatically, therefore the amount of bundles varies.
Therefore we must tell FuseBox to create a single bundle for that matter.

Use the `useSingleBundle` field to achieve that:

```ts
fusebox({
  output: 'dist/main/$name-$hash',
  target: 'electron',
  homeDir: 'src/main',
  entry: 'main.ts',
  useSingleBundle: true,
  dependencies: { ignoreAllExternal: true },
  logging: { level: 'succinct' },
  cache: {
    enabled: true,
    root: '.cache/main',
  },
});
```

We set target `electron`, and with custom `output` and `homeDir`.

You need a custom `homeDir` for the watcher. Make sure that the launcher and your renderer are located in different
folders as they serve different purposes.

```
- src
    - launcher
    - main
fuse.ts
```

**Important to note** Make sure you have different `homeDir` fields.

Electron dependencies for the launcher cannot be bundled, as those don't have bundle compatible packages (they are all
native), make sure you ignore all external dependencies:

```ts
{
  dependencies: {
    ignoreAllExternal: true;
  }
}
```

### Enable "require"

FuseBox will not bundle natives e.g. `fs` or `path`, therefore you must enable NodeJS Integration

```ts
mainWindow = new BrowserWindow({
  ...windowBounds.get(),
  webPreferences: {
    nodeIntegration: true,
  },
});
```

### Launching

After the process is completed you can launch the application by using a special electron handler in FuseBox;

```ts
const main = fusebox({
  /* configuration */
}};
main.runDev(handler => {
  handler.onComplete(output => {
    output.electron.handleMainProcess();
  });
})
```

You need to have `electron` package installed. `output.electron` is a getter function, which will verify all required
conditions in order to launch the electron process. It will also verify the `useSingleBundle` option.

Now you can sit back and relax, FuseBox will manage the process and start/restart the application when your `main`
launcher is changed. That's why it's important to split the renderer and the launcher to avoid unnecessary restarts

## Configuration the renderer

Here is an example of a valid renderer config:

```ts
fusebox({
  output: 'dist/renderer/$name-$hash',
  target: 'electron',
  homeDir: 'src/renderer',
  entry: 'index.ts',
  dependencies: { include: ['tslib'] },
  logging: { level: 'succinct' },
  webIndex: {
    publicPath: './',
    template: 'src/renderer/index.html',
  },
  cache: {
    enabled: false,
    root: '.cache/renderere',
  },
  devServer: {
    httpServer: false,
    hmrServer: { port: 7878 },
  },
});
```

Make sure to set custom `output` and `homeDir`

### Loading the application

You can use the devServer, however it's not really necessary, since FuseBox can launch a separate WebSocket and
communicate with the process (for the HMR )

```ts
{
  devServer: {
    httpServer: false,
    hmrServer: { port: 7878 },
  }
}
```

Additionally, let's tweak `webIndex` configuration in order for the bundles to get loaded correctly

```ts
{
webIndex: {
    publicPath: './',
    template: 'src/renderer/index.html',
  }
}
```

And finally, let's modify our main process, to load `index.html` which is generated by the `renderer`

Assuming the following dist structure:

```
- dist
  - main
  - renderer
```

Open your `main.ts` module and configure the `mainWindow`

```ts
mainWindow.loadURL(
  url.format({
    pathname: path.join(app.getAppPath(), '../', 'renderer', `index.html`),
    protocol: 'file:',
    slashes: true,
  }),
);
```

## Production builds

Production build (like any other scenario) is initiated by calling `runProd`. But unlike `runDev` as we know, it has a
slightly different API;

```ts
await electronMain.runProd({
  uglify: true,
  manifest: true,
  handler: handler => {
    handler.onComplete(output => {
      output.electron.handleMainProcess();
    });
  },
});
```

You can use the same handler, available in `runProd` under the `handler` field to launch and preview the application.

It's recommended to generate a manifest file. That will help you to create a production electron launcher. Since all the
bundles will be hashed, that would the right place to look for your application entry point.

```json
{
  "bundles": [
    {
      "type": "PROJECT_JS",
      "size": 1887,
      "absPath": "electron/dist/main/app-38c09469.js",
      "localPath": "app-38c09469.js",
      "name": "app",
      "priority": 10,
      "relBrowserPath": "app-38c09469.js",
      "webIndexed": true
    }
  ]
}
```
